<!-- build time:Thu Nov 15 2018 02:30:25 GMT+0800 (中国标准时间) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="true"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple.png?v=6.4.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.png?v=6.4.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.png?v=6.4.0"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"6.4.0",sidebar:{position:"right",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="keywords" content="没有关键字"><meta property="og:type" content="website"><meta property="og:title" content="蓝生的博客"><meta property="og:url" content="https://www.lansheng.net.cn/page/25/index.html"><meta property="og:site_name" content="蓝生的博客"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="蓝生的博客"><link rel="alternate" href="/atom.xml" title="蓝生的博客" type="application/atom+xml"><link rel="canonical" href="https://www.lansheng.net.cn/page/25/"><script type="text/javascript" id="page.configurations">CONFIG.page={sidebar:""}</script><title>蓝生的博客</title><noscript><style type="text/css">.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-right page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">蓝生的博客</span> <span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.lansheng.net.cn/blog/c91be9a9/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="蓝生"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="蓝生的博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/blog/c91be9a9/" itemprop="url">使用java给Hexo博客内文章生成HexoFrontMatter</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-07-30 13:42:11" itemprop="dateCreated datePublished" datetime="2018-07-30T13:42:11+08:00">2018-07-30</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2018-11-05 17:17:09" itemprop="dateModified" datetime="2018-11-05T17:17:09+08:00">2018-11-05</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/我的软件/" itemprop="url" rel="index"><span itemprop="name">我的软件</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/我的软件/Hexo博客工具程序/" itemprop="url" rel="index"><span itemprop="name">Hexo博客工具程序</span></a></span> </span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/blog/c91be9a9/#comments" itemprop="discussionUrl"><span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/blog/c91be9a9/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p>文章正文……<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## 需求 ##</span><br><span class="line">使用java为Hexo博客所有文章添加font-matter,要求如下：</span><br><span class="line">- 使用文件名作为标题即，`title: 文件名`</span><br><span class="line">- 使用多级子目录作为多级分类，例如`&quot;D:\Blog\bolg5\source\_posts\MyApplications\HexoTools\java自动生成HexoFontMatter.md&quot;`文章根目录为`D:\Blog\bolg5\source\_posts`，则多级分类为：</span><br></pre></td></tr></table></figure><p></p><p>categories:</p><ul><li>MyApplications</li><li>HexoTools<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br></pre></td><td class="code"><pre><span class="line">- 使用文章最后修改的时间做我时间标记Date,即`Date: 文章最后修改的时间`</span><br><span class="line"></span><br><span class="line">&lt;!--more--&gt;</span><br><span class="line">## 实现 ##</span><br><span class="line">之前我代码已经写好了一部分，当时好像没有写文档。代码如下：</span><br><span class="line">```java</span><br><span class="line">package front.matter.tools;</span><br><span class="line"></span><br><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.BufferedWriter;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.FilenameFilter;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line">import java.io.OutputStreamWriter;</span><br><span class="line">import java.io.UnsupportedEncodingException;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.regex.Matcher;</span><br><span class="line">import java.util.regex.Pattern;</span><br><span class="line">import clipboard.util.SysClipboardUtil;</span><br><span class="line"></span><br><span class="line">public class HexoAddFrontMatterAllInDir</span><br><span class="line">&#123;</span><br><span class="line">	public static void main(String[] args)</span><br><span class="line">	&#123;</span><br><span class="line">		String dirPath=SysClipboardUtil.getSysClipboardText();</span><br><span class="line">		dealDir(dirPath);</span><br><span class="line">		System.out.println(&quot;遍历结束&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 对该目录下的所有markdown文档加Front-matter首部</span><br><span class="line">	 * </span><br><span class="line">	 * @param dirpath</span><br><span class="line">	 */</span><br><span class="line">	public static void dealDir(String dirpath)</span><br><span class="line">	&#123;</span><br><span class="line">		File dirFile = new File(dirpath);</span><br><span class="line">		// 如果是文件夹的话</span><br><span class="line">		if (dirFile.isDirectory())</span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line">			// 获取md文件，或者是目录的列表</span><br><span class="line">			File[] fileList = dirFile.listFiles(new FilenameFilter()</span><br><span class="line">			&#123;</span><br><span class="line">				@Override</span><br><span class="line">				public boolean accept(File dir, String name)</span><br><span class="line">				&#123;</span><br><span class="line">					// 如果是markdown文件的话</span><br><span class="line">					if (name.endsWith(&quot;.md&quot;))</span><br><span class="line">						return true;</span><br><span class="line">					// 如果是一个目录的话</span><br><span class="line">					else if (new File(dir, name).isDirectory())</span><br><span class="line">						return true;</span><br><span class="line">					// 其他不相关的文件不返回</span><br><span class="line">					return false;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">			try</span><br><span class="line">			&#123;</span><br><span class="line">				for (File file : fileList)</span><br><span class="line">				&#123;</span><br><span class="line">					// 输出正在处理的文件名</span><br><span class="line">					// System.out.println(file.getAbsolutePath());</span><br><span class="line">					// 如果是文件的话</span><br><span class="line">					if (file.isFile())</span><br><span class="line">					&#123;</span><br><span class="line">						// 在文章首部添加文件首部</span><br><span class="line">						addIfHasNotFrontMatter(file);</span><br><span class="line">						//更新文章首部，使用最近修改的时间作为文章的创建时间</span><br><span class="line">//						updateIfHasFrontMatter(file);</span><br><span class="line">					&#125; else</span><br><span class="line">						// 递归调用下层目录</span><br><span class="line">						dealDir(file.getAbsolutePath());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; catch (UnsupportedEncodingException e)</span><br><span class="line">			&#123;</span><br><span class="line">				// TODO Auto-generated catch block</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; catch (FileNotFoundException e)</span><br><span class="line">			&#123;</span><br><span class="line">				// TODO Auto-generated catch block</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; catch (IOException e)</span><br><span class="line">			&#123;</span><br><span class="line">				// TODO Auto-generated catch block</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		// 如果是markdown文件的话也可以直接使用进行首部追加</span><br><span class="line">		else if (dirFile.isFile() &amp;&amp; dirFile.getAbsolutePath().endsWith(&quot;.md&quot;))</span><br><span class="line">		&#123;</span><br><span class="line">			// 在文章首部添加文件首部</span><br><span class="line">			try</span><br><span class="line">			&#123;</span><br><span class="line">				addIfHasNotFrontMatter(dirFile);</span><br><span class="line">			&#125; catch (UnsupportedEncodingException e)</span><br><span class="line">			&#123;</span><br><span class="line">				// TODO Auto-generated catch block</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; catch (FileNotFoundException e)</span><br><span class="line">			&#123;</span><br><span class="line">				// TODO Auto-generated catch block</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; catch (IOException e)</span><br><span class="line">			&#123;</span><br><span class="line">				// TODO Auto-generated catch block</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * @param file</span><br><span class="line">	 * @throws IOException</span><br><span class="line">	 * @throws FileNotFoundException</span><br><span class="line">	 * @throws UnsupportedEncodingException</span><br><span class="line">	 */</span><br><span class="line">	private static void addIfHasNotFrontMatter(File file)</span><br><span class="line">			throws UnsupportedEncodingException, FileNotFoundException,</span><br><span class="line">			IOException</span><br><span class="line">	&#123;</span><br><span class="line">		// TODO Auto-generated method stub</span><br><span class="line">		addIfHasNotFrontMatter(file.getAbsolutePath());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * @param path</span><br><span class="line">	 * @throws UnsupportedEncodingException</span><br><span class="line">	 * @throws FileNotFoundException</span><br><span class="line">	 * @throws IOException</span><br><span class="line">	 */</span><br><span class="line">	public static void addIfHasNotFrontMatter(String path)</span><br><span class="line">			throws UnsupportedEncodingException, FileNotFoundException,</span><br><span class="line">			IOException</span><br><span class="line">	&#123;</span><br><span class="line">		File file = new File(path);</span><br><span class="line">		// 如果是markdown文档</span><br><span class="line">		if (file.isFile() &amp;&amp; path.endsWith(&quot;.md&quot;))</span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line">			// 读取文件到文章缓冲article中</span><br><span class="line">			StringBuilder article = readFile(file);</span><br><span class="line">			// 如果在文章中没有发现首部存在</span><br><span class="line">			if (!hasFrontMatter(article))</span><br><span class="line">			&#123;</span><br><span class="line">				// 就添加首部</span><br><span class="line">				StringBuilder frontmatter = createFrontMatter(file);</span><br><span class="line">				// 然后在正文前面首部</span><br><span class="line">				article.insert(0, frontmatter);</span><br><span class="line">				// 处理结果写回该文件</span><br><span class="line">				writeFile(file, article);</span><br><span class="line">				System.out.println(&quot;处理完成:&quot;+path);</span><br><span class="line">			&#125; else</span><br><span class="line">			&#123;</span><br><span class="line">				System.out.println(&quot;已经存在首部了，不再重复加入&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	/**   </span><br><span class="line">	 * @param file  </span><br><span class="line">	 * @throws IOException </span><br><span class="line">	 * @throws FileNotFoundException </span><br><span class="line">	 * @throws UnsupportedEncodingException </span><br><span class="line">	 */  </span><br><span class="line">	private static void updateIfHasFrontMatter(File file) throws UnsupportedEncodingException, FileNotFoundException, IOException</span><br><span class="line">	&#123;</span><br><span class="line">		// TODO Auto-generated method stub</span><br><span class="line">		updateIfHasFrontMatter(file.getAbsolutePath());</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * @param path</span><br><span class="line">	 * @throws UnsupportedEncodingException</span><br><span class="line">	 * @throws FileNotFoundException</span><br><span class="line">	 * @throws IOException</span><br><span class="line">	 */</span><br><span class="line">	public static void updateIfHasFrontMatter(String path)</span><br><span class="line">			throws UnsupportedEncodingException, FileNotFoundException,</span><br><span class="line">			IOException</span><br><span class="line">	&#123;</span><br><span class="line">		File file = new File(path);</span><br><span class="line">		// 如果是markdown文档</span><br><span class="line">		if (file.isFile() &amp;&amp; path.endsWith(&quot;.md&quot;))</span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line">			// 读取文件到文章缓冲article中</span><br><span class="line">			StringBuilder article = readFile(file);</span><br><span class="line">			// 从文章中移除原来的首部</span><br><span class="line">			removeOldFrontMatter(article);</span><br><span class="line">			// 根据文件名生成新的首部</span><br><span class="line">			StringBuilder frontmatter = createFrontMatter(file);</span><br><span class="line">			// 然后在正文前面首部</span><br><span class="line">			article.insert(0, frontmatter);</span><br><span class="line">			// 处理结果写回该文件</span><br><span class="line">			writeFile(file, article);</span><br><span class="line">			System.out.println(&quot;更新首部：&quot;+path);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * @param file</span><br><span class="line">	 * @param article</span><br><span class="line">	 * @throws UnsupportedEncodingException</span><br><span class="line">	 * @throws FileNotFoundException</span><br><span class="line">	 * @throws IOException</span><br><span class="line">	 */</span><br><span class="line">	public static void writeFile(File file, StringBuilder article)</span><br><span class="line">			throws UnsupportedEncodingException, FileNotFoundException,</span><br><span class="line">			IOException</span><br><span class="line">	&#123;</span><br><span class="line">		BufferedWriter writer = new BufferedWriter(</span><br><span class="line">				new OutputStreamWriter(new FileOutputStream(file), &quot;utf-8&quot;));</span><br><span class="line">		writer.write(article.toString());</span><br><span class="line">		writer.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * @param path</span><br><span class="line">	 * @param file</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public static StringBuilder createFrontMatter(File file)</span><br><span class="line">	&#123;</span><br><span class="line">		String path = file.getAbsolutePath();</span><br><span class="line">		// 生成首部</span><br><span class="line">		StringBuilder frontmatter = new StringBuilder();</span><br><span class="line">		String filename = file.getName();</span><br><span class="line">		// 获取不含后缀的文件名,作为未标题</span><br><span class="line">		String title = filename.substring(0, filename.length() - 3);</span><br><span class="line">		frontmatter.append(&quot;title: &quot; + title);</span><br><span class="line">		// 获取子目录列表</span><br><span class="line">		int categoriesStart = path.indexOf(&quot;\\source\\_posts&quot;)</span><br><span class="line">				+ &quot;\\source\\_posts&quot;.length();</span><br><span class="line">		int categoriesEnd = path.indexOf(filename) - 1;</span><br><span class="line">		String categoriesStr = path.substring(categoriesStart, categoriesEnd);</span><br><span class="line">		categoriesStr = categoriesStr.replaceAll(&quot;\\\\&quot;, &quot;\n- &quot;);</span><br><span class="line">		frontmatter.append(&quot;\ncategories: &quot; + categoriesStr);</span><br><span class="line">		// 生成时间项</span><br><span class="line">		SimpleDateFormat dateFormat = new SimpleDateFormat(</span><br><span class="line">				&quot;yyyy-MM-dd HH:mm:ss&quot;);// 使用24小时制</span><br><span class="line">		Date date = new Date(file.lastModified());</span><br><span class="line">		frontmatter.append(&quot;\ndate: &quot; + dateFormat.format(date));</span><br><span class="line">		frontmatter.append(&quot;\n---\n&quot;);// 加入frontmatter首部</span><br><span class="line">		return frontmatter;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * @param builder</span><br><span class="line">	 */</span><br><span class="line">	public static void removeOldFrontMatter(StringBuilder builder)</span><br><span class="line">	&#123;</span><br><span class="line">		// 检查文章中是否有首部</span><br><span class="line">		Pattern hasFrontMatter = Pattern.compile(&quot;(?:---\\n)?(?:.*\\n)+---\\n&quot;);</span><br><span class="line">		// System.out.println(&quot;使用的正则表达式:&quot; + hasFrontMatter);</span><br><span class="line">		Matcher matcherFrontMatter = hasFrontMatter.matcher(builder);</span><br><span class="line">		int start = 0, end = 0;</span><br><span class="line">		// 从文章首部开始匹配，匹配到了就不再匹配</span><br><span class="line">		if (matcherFrontMatter.lookingAt())</span><br><span class="line">		&#123;</span><br><span class="line">			start = matcherFrontMatter.start();</span><br><span class="line">			end = matcherFrontMatter.end();</span><br><span class="line">			// 移除首部</span><br><span class="line">			builder.delete(start, end);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * @param builder</span><br><span class="line">	 */</span><br><span class="line">	public static boolean hasFrontMatter(StringBuilder builder)</span><br><span class="line">	&#123;</span><br><span class="line">		// 检查文章中是否有首部</span><br><span class="line">		Pattern hasFrontMatter = Pattern.compile(&quot;(?:---\\n)?(?:.*\\n)+---\\n&quot;);</span><br><span class="line">		Matcher matcherFrontMatter = hasFrontMatter.matcher(builder);</span><br><span class="line">		return matcherFrontMatter.lookingAt();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * @param file</span><br><span class="line">	 * @param builder</span><br><span class="line">	 * @throws UnsupportedEncodingException</span><br><span class="line">	 * @throws FileNotFoundException</span><br><span class="line">	 * @throws IOException</span><br><span class="line">	 */</span><br><span class="line">	public static StringBuilder readFile(File file)</span><br><span class="line">			throws UnsupportedEncodingException, FileNotFoundException,</span><br><span class="line">			IOException</span><br><span class="line">	&#123;</span><br><span class="line">		StringBuilder builder = new StringBuilder(5000);</span><br><span class="line">		// 先把文章读入缓冲中</span><br><span class="line">		BufferedReader reader = new BufferedReader(</span><br><span class="line">				new InputStreamReader(new FileInputStream(file), &quot;utf-8&quot;));</span><br><span class="line">		String line = null;</span><br><span class="line">		// 一行一行的读取</span><br><span class="line">		while ((line = reader.readLine()) != null)</span><br><span class="line">		&#123;</span><br><span class="line">			builder.append(line + &quot;\n&quot;);// 添加到缓冲中</span><br><span class="line">		&#125;</span><br><span class="line">		reader.close();// 关闭文件</span><br><span class="line">		return builder;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>上面的代码已经完成了功能，但是在使用的过程中还是有一些问题的，先来看主函数：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	String dirPath=SysClipboardUtil.getSysClipboardText();</span><br><span class="line">	dealDir(dirPath);</span><br><span class="line">	System.out.println(<span class="string">"遍历结束"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>这里的需要从剪贴板获取需要处理文章的绝对路径，或者是所在的目录。</p><ul><li>如果是文章，就直接对该文章中添加front-matter,添加的算法是，生成front-matter到一个字符缓冲中，然后把文章也读入，追加到缓冲中，然后把文章缓冲覆盖写入到文件中。</li><li>如果是目录则递归遍历整个目录，检查文章是否已经有了front-matter,如果没有就添加，如果有了就不做处理。</li></ul><p>我现在要做的就是修改主方法，因为我不想每次传递路径到程序中，我的博客路径搭建之后就固定为<code>D:\Blog\bolg5\source\_posts</code>，我只需要递归遍历这个目录即可。虽然这样需要处理博客中的所有文章，空间和时间消耗可能大点。但是无所谓，我就是懒得传递路径到程序，因为我需要先要复制文章的路径到剪贴板，然后在调用程序。而修改后我可以直接调用就行。少了一个步骤。<br>修改后的主函数为：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	String dirPath = SysClipboardUtil.getSysClipboardText();</span><br><span class="line">	<span class="comment">// 如果剪贴板中有东西</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="string">""</span>.equals(dirPath))</span><br><span class="line">	&#123;</span><br><span class="line">		dealDir(dirPath);</span><br><span class="line">		System.out.println(<span class="string">"遍历结束"</span>);</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="comment">//如果剪贴板没有东西就默认对所有的文章进行处理</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 默认的博客文章地址</span></span><br><span class="line">		String defaultPath = <span class="string">"D:\\Blog\\bolg5\\source\\_posts"</span>;</span><br><span class="line">		dealDir(dirPath);</span><br><span class="line">		System.out.println(<span class="string">"处理所有文章结束"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>运行后我发现问题了，剪贴板中可能随时有东西。这些信息不一定是路径，这样就会进入第一个分支，从而运行错误。解决方法：</p><ul><li>方案1：不再使用剪贴板传递参数，而是使用命令行参数，Windows运行框是可以传入命令行参数的，到时候修改一下bat文件把命令行参数传入java程序。</li><li>方案2：继续修改主代码，先检查参数是不是路径，如果是，dealDir()方法就使用该路径，如果不是dealDir()方法就使用默认路径。</li></ul><h2 id="方案2"><a href="#方案2" class="headerlink" title="方案2"></a>方案2</h2><p>修改代码为：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	String dirPath = SysClipboardUtil.getSysClipboardText();</span><br><span class="line">	File file=<span class="keyword">new</span> File(dirPath);</span><br><span class="line">	<span class="keyword">if</span>(file.isDirectory()||file.isFile())</span><br><span class="line">	&#123;</span><br><span class="line">		dealDir(dirPath);</span><br><span class="line">		System.out.println(<span class="string">"遍历结束"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//如果剪贴板没有东西就默认对所有的文章进行处理</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 默认的博客文章地址</span></span><br><span class="line">		String defaultPath = <span class="string">"D:\\Blog\\bolg5\\source\\_posts"</span>;</span><br><span class="line">		dealDir(defaultPath);</span><br><span class="line">		System.out.println(<span class="string">"处理所有文章结束"</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><p></p><p>这样就可以了，程序输出：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line">已经存在首部了，不再重复加入</span><br><span class="line">处理完成:D:\Blog\bolg5\source\_posts\MyApplications\HexoTools\java自动生成HexoFontMatter.md</span><br><span class="line">已经存在首部了，不再重复加入</span><br><span class="line">......</span><br><span class="line">处理所有文章结束</span><br></pre></td></tr></table></figure><p></p><p>可以看到我最新写的文章<code>D:\Blog\bolg5\source\_posts\MyApplications\HexoTools\java自动生成HexoFontMatter.md</code>已经处理完毕。其他文章已经有front-matter程序不在添加。</p><p>使用方案2的好处就是我只管复制路径，然后调用程序，或者调用程序(默认)即可。而使用命令行参数的话还需要粘贴一次。<br>本次优化到此结束。<br>整个程序的代码为：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> front.matter.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FilenameFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStreamWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"><span class="keyword">import</span> clipboard.util.SysClipboardUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HexoAddFrontMatterAllInDir</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		String dirPath = SysClipboardUtil.getSysClipboardText();</span><br><span class="line">		File file=<span class="keyword">new</span> File(dirPath);</span><br><span class="line">		<span class="keyword">if</span>(file.isDirectory()||file.isFile())</span><br><span class="line">		&#123;</span><br><span class="line">			dealDir(dirPath);</span><br><span class="line">			System.out.println(<span class="string">"遍历结束"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//如果剪贴板没有东西就默认对所有的文章进行处理</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 默认的博客文章地址</span></span><br><span class="line">			String defaultPath = <span class="string">"D:\\Blog\\bolg5\\source\\_posts"</span>;</span><br><span class="line">			dealDir(defaultPath);</span><br><span class="line">			System.out.println(<span class="string">"处理所有文章结束"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 对该目录下的所有markdown文档加Front-matter首部</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> dirpath</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dealDir</span><span class="params">(String dirpath)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		File dirFile = <span class="keyword">new</span> File(dirpath);</span><br><span class="line">		<span class="comment">// 如果是文件夹的话</span></span><br><span class="line">		<span class="keyword">if</span> (dirFile.isDirectory())</span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 获取md文件，或者是目录的列表</span></span><br><span class="line">			File[] fileList = dirFile.listFiles(<span class="keyword">new</span> FilenameFilter()</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">accept</span><span class="params">(File dir, String name)</span></span></span><br><span class="line"><span class="function">				</span>&#123;</span><br><span class="line">					<span class="comment">// 如果是markdown文件的话</span></span><br><span class="line">					<span class="keyword">if</span> (name.endsWith(<span class="string">".md"</span>))</span><br><span class="line">						<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">					<span class="comment">// 如果是一个目录的话</span></span><br><span class="line">					<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">new</span> File(dir, name).isDirectory())</span><br><span class="line">						<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">					<span class="comment">// 其他不相关的文件不返回</span></span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">			<span class="keyword">try</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span> (File file : fileList)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="comment">// 输出正在处理的文件名</span></span><br><span class="line">					<span class="comment">// System.out.println(file.getAbsolutePath());</span></span><br><span class="line">					<span class="comment">// 如果是文件的话</span></span><br><span class="line">					<span class="keyword">if</span> (file.isFile())</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="comment">// 在文章首部添加文件首部</span></span><br><span class="line">						addIfHasNotFrontMatter(file);</span><br><span class="line">						<span class="comment">// 更新文章首部，使用最近修改的时间作为文章的创建时间</span></span><br><span class="line">						<span class="comment">// updateIfHasFrontMatter(file);</span></span><br><span class="line">					&#125; <span class="keyword">else</span></span><br><span class="line">						<span class="comment">// 递归调用下层目录</span></span><br><span class="line">						dealDir(file.getAbsolutePath());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (FileNotFoundException e)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 如果是markdown文件的话也可以直接使用进行首部追加</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (dirFile.isFile() &amp;&amp; dirFile.getAbsolutePath().endsWith(<span class="string">".md"</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 在文章首部添加文件首部</span></span><br><span class="line">			<span class="keyword">try</span></span><br><span class="line">			&#123;</span><br><span class="line">				addIfHasNotFrontMatter(dirFile);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (FileNotFoundException e)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> FileNotFoundException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> UnsupportedEncodingException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addIfHasNotFrontMatter</span><span class="params">(File file)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> UnsupportedEncodingException, FileNotFoundException,</span></span><br><span class="line"><span class="function">			IOException</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		addIfHasNotFrontMatter(file.getAbsolutePath());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> UnsupportedEncodingException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> FileNotFoundException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addIfHasNotFrontMatter</span><span class="params">(String path)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> UnsupportedEncodingException, FileNotFoundException,</span></span><br><span class="line"><span class="function">			IOException</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		File file = <span class="keyword">new</span> File(path);</span><br><span class="line">		<span class="comment">// 如果是markdown文档</span></span><br><span class="line">		<span class="keyword">if</span> (file.isFile() &amp;&amp; path.endsWith(<span class="string">".md"</span>))</span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 读取文件到文章缓冲article中</span></span><br><span class="line">			StringBuilder article = readFile(file);</span><br><span class="line">			<span class="comment">// 如果在文章中没有发现首部存在</span></span><br><span class="line">			<span class="keyword">if</span> (!hasFrontMatter(article))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// 就添加首部</span></span><br><span class="line">				StringBuilder frontmatter = createFrontMatter(file);</span><br><span class="line">				<span class="comment">// 然后在正文前面首部</span></span><br><span class="line">				article.insert(<span class="number">0</span>, frontmatter);</span><br><span class="line">				<span class="comment">// 处理结果写回该文件</span></span><br><span class="line">				writeFile(file, article);</span><br><span class="line">				System.out.println(<span class="string">"处理完成:"</span> + path);</span><br><span class="line">			&#125; <span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				System.out.println(<span class="string">"已经存在首部了，不再重复加入"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> FileNotFoundException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> UnsupportedEncodingException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">updateIfHasFrontMatter</span><span class="params">(File file)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> UnsupportedEncodingException, FileNotFoundException,</span></span><br><span class="line"><span class="function">			IOException</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		updateIfHasFrontMatter(file.getAbsolutePath());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> UnsupportedEncodingException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> FileNotFoundException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">updateIfHasFrontMatter</span><span class="params">(String path)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> UnsupportedEncodingException, FileNotFoundException,</span></span><br><span class="line"><span class="function">			IOException</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		File file = <span class="keyword">new</span> File(path);</span><br><span class="line">		<span class="comment">// 如果是markdown文档</span></span><br><span class="line">		<span class="keyword">if</span> (file.isFile() &amp;&amp; path.endsWith(<span class="string">".md"</span>))</span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 读取文件到文章缓冲article中</span></span><br><span class="line">			StringBuilder article = readFile(file);</span><br><span class="line">			<span class="comment">// 从文章中移除原来的首部</span></span><br><span class="line">			removeOldFrontMatter(article);</span><br><span class="line">			<span class="comment">// 根据文件名生成新的首部</span></span><br><span class="line">			StringBuilder frontmatter = createFrontMatter(file);</span><br><span class="line">			<span class="comment">// 然后在正文前面首部</span></span><br><span class="line">			article.insert(<span class="number">0</span>, frontmatter);</span><br><span class="line">			<span class="comment">// 处理结果写回该文件</span></span><br><span class="line">			writeFile(file, article);</span><br><span class="line">			System.out.println(<span class="string">"更新首部："</span> + path);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> article</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> UnsupportedEncodingException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> FileNotFoundException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeFile</span><span class="params">(File file, StringBuilder article)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> UnsupportedEncodingException, FileNotFoundException,</span></span><br><span class="line"><span class="function">			IOException</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		BufferedWriter writer = <span class="keyword">new</span> BufferedWriter(</span><br><span class="line">				<span class="keyword">new</span> OutputStreamWriter(<span class="keyword">new</span> FileOutputStream(file), <span class="string">"utf-8"</span>));</span><br><span class="line">		writer.write(article.toString());</span><br><span class="line">		writer.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StringBuilder <span class="title">createFrontMatter</span><span class="params">(File file)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		String path = file.getAbsolutePath();</span><br><span class="line">		<span class="comment">// 生成首部</span></span><br><span class="line">		StringBuilder frontmatter = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">		String filename = file.getName();</span><br><span class="line">		<span class="comment">// 获取不含后缀的文件名,作为未标题</span></span><br><span class="line">		String title = filename.substring(<span class="number">0</span>, filename.length() - <span class="number">3</span>);</span><br><span class="line">		frontmatter.append(<span class="string">"title: "</span> + title);</span><br><span class="line">		<span class="comment">// 获取子目录列表</span></span><br><span class="line">		<span class="keyword">int</span> categoriesStart = path.indexOf(<span class="string">"\\source\\_posts"</span>)</span><br><span class="line">				+ <span class="string">"\\source\\_posts"</span>.length();</span><br><span class="line">		<span class="keyword">int</span> categoriesEnd = path.indexOf(filename) - <span class="number">1</span>;</span><br><span class="line">		String categoriesStr = path.substring(categoriesStart, categoriesEnd);</span><br><span class="line">		categoriesStr = categoriesStr.replaceAll(<span class="string">"\\\\"</span>, <span class="string">"\n- "</span>);</span><br><span class="line">		frontmatter.append(<span class="string">"\ncategories: "</span> + categoriesStr);</span><br><span class="line">		<span class="comment">// 生成时间项</span></span><br><span class="line">		SimpleDateFormat dateFormat = <span class="keyword">new</span> SimpleDateFormat(</span><br><span class="line">				<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);<span class="comment">// 使用24小时制</span></span><br><span class="line">		Date date = <span class="keyword">new</span> Date(file.lastModified());</span><br><span class="line">		frontmatter.append(<span class="string">"\ndate: "</span> + dateFormat.format(date));</span><br><span class="line">		frontmatter.append(<span class="string">"\n---\n"</span>);<span class="comment">// 加入frontmatter首部</span></span><br><span class="line">		<span class="keyword">return</span> frontmatter;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> builder</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeOldFrontMatter</span><span class="params">(StringBuilder builder)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 检查文章中是否有首部</span></span><br><span class="line">		Pattern hasFrontMatter = Pattern.compile(<span class="string">"(?:---\\n)?(?:.*\\n)+---\\n"</span>);</span><br><span class="line">		<span class="comment">// System.out.println("使用的正则表达式:" + hasFrontMatter);</span></span><br><span class="line">		Matcher matcherFrontMatter = hasFrontMatter.matcher(builder);</span><br><span class="line">		<span class="keyword">int</span> start = <span class="number">0</span>, end = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">// 从文章首部开始匹配，匹配到了就不再匹配</span></span><br><span class="line">		<span class="keyword">if</span> (matcherFrontMatter.lookingAt())</span><br><span class="line">		&#123;</span><br><span class="line">			start = matcherFrontMatter.start();</span><br><span class="line">			end = matcherFrontMatter.end();</span><br><span class="line">			<span class="comment">// 移除首部</span></span><br><span class="line">			builder.delete(start, end);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> builder</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasFrontMatter</span><span class="params">(StringBuilder builder)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 检查文章中是否有首部</span></span><br><span class="line">		Pattern hasFrontMatter = Pattern.compile(<span class="string">"(?:---\\n)?(?:.*\\n)+---\\n"</span>);</span><br><span class="line">		Matcher matcherFrontMatter = hasFrontMatter.matcher(builder);</span><br><span class="line">		<span class="keyword">return</span> matcherFrontMatter.lookingAt();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> builder</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> UnsupportedEncodingException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> FileNotFoundException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StringBuilder <span class="title">readFile</span><span class="params">(File file)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> UnsupportedEncodingException, FileNotFoundException,</span></span><br><span class="line"><span class="function">			IOException</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		StringBuilder builder = <span class="keyword">new</span> StringBuilder(<span class="number">5000</span>);</span><br><span class="line">		<span class="comment">// 先把文章读入缓冲中</span></span><br><span class="line">		BufferedReader reader = <span class="keyword">new</span> BufferedReader(</span><br><span class="line">				<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(file), <span class="string">"utf-8"</span>));</span><br><span class="line">		String line = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 一行一行的读取</span></span><br><span class="line">		<span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			builder.append(line + <span class="string">"\n"</span>);<span class="comment">// 添加到缓冲中</span></span><br><span class="line">		&#125;</span><br><span class="line">		reader.close();<span class="comment">// 关闭文件</span></span><br><span class="line">		<span class="keyword">return</span> builder;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>依赖代码：</p><p>本文链接: <a href="https://www.lansheng.net.cn/blog/c91be9a9/">使用java给Hexo博客内文章生成HexoFrontMatter</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.lansheng.net.cn/blog/3bbde7b0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="蓝生"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="蓝生的博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/blog/3bbde7b0/" itemprop="url">JAVA优化建议</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-07-30 13:42:11" itemprop="dateCreated datePublished" datetime="2018-07-30T13:42:11+08:00">2018-07-30</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2018-11-05 17:17:08" itemprop="dateModified" datetime="2018-11-05T17:17:08+08:00">2018-11-05</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/其他/" itemprop="url" rel="index"><span itemprop="name">其他</span></a></span> </span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/blog/3bbde7b0/#comments" itemprop="discussionUrl"><span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/blog/3bbde7b0/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p><strong>代码优化的目标是：</strong><br>1、减小代码的体积<br>2、提高代码运行的效率<br></p><div class="post-button text-center"><a class="btn" href="/blog/3bbde7b0/#more" rel="contents">阅读全文 &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.lansheng.net.cn/blog/5ab73df2/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="蓝生"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="蓝生的博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/blog/5ab73df2/" itemprop="url">30个要点帮你完成java代码优化</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-07-29 22:51:00" itemprop="dateCreated datePublished" datetime="2018-07-29T22:51:00+08:00">2018-07-29</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2018-11-05 17:17:08" itemprop="dateModified" datetime="2018-11-05T17:17:08+08:00">2018-11-05</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/其他/" itemprop="url" rel="index"><span itemprop="name">其他</span></a></span> </span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/blog/5ab73df2/#comments" itemprop="discussionUrl"><span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/blog/5ab73df2/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p>本文转载自：<a href="https://www.cnblogs.com/zhaoyan001/p/6078196.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhaoyan001/p/6078196.html</a></p><p>通过java代码规范来优化程序，优化内存使用情况，防止内存泄露</p><p><strong>可供程序利用的资源（内存、CPU时间、网络带宽等）是有限的，优化的目的就是让程序用尽可能少的资源完成预定的任务。</strong><br><strong>优化通常包含两方面的内容：</strong></p><ul><li>减小代码的体积</li><li>提高代码的运行效率。</li></ul><p><strong>本文讨论的主要是如何提高代码的效率。</strong></p><p>在Java程序中，性能问题的大部分原因并不在于Java语言，而是在于程序本身。养成好的代码编写习惯非常重要，比如正确地、巧妙地运用java.lang.String类和java.util.Vector类，它能够显著地提高程序的性能。下面我们就来具体地分析一下这方面的问题。</p><p><strong>1、 尽量指定类的final修饰符 带有final修饰符的类是不可派生的</strong></p><p>在Java核心API中，有许多应用final的例子，例如java.lang.String。为String类指定final防止了人们覆盖length()方法。另外，<strong>如果指定一个类为final，则该类所有的方法都是final。Java编译器会寻找机会内联（inline）所有的final方法（这和具体的编译器实现有关）。此举能够使性能平均提高50% 。</strong></p><p><strong>2、 尽量重用对象</strong></p><p>特别是String 对象的使用中，<strong>频繁出现字符串连接情况时应用StringBuffer 代替</strong>。由于系统不仅要花时间生成对象，以后可能还需花时间对这些对象进行垃圾回收和处理。因此，生成过多的对象将会给程序的性能带来很大的影响。</p><p><strong>3、 尽量使用局部变量</strong></p><p>调用方法时传递的参数以及在调用中创建的临时变量都保存在栈（Stack）中，速度较快。<br>其他变量，如静态变量、实例变量等，都在堆（Heap）中创建，速度较慢。另外，依赖于具体的编译器/JVM，局部变量还可能得到进一步优化。请参见《尽可能使用堆栈变量》。</p><p><strong>4、 不要重复初始化变量</strong><br>默认情况下，调用类的构造函数时， Java会把变量初始化成确定的值：所有的对象被设置成null，整数变量（byte、short、int、long）设置成0，float和double变量设置成0.0，逻辑值设置成false。当一个类从另一个类派生时，这一点尤其应该注意，因为用new关键词创建一个对象时，构造函数链中的所有构造函数都会被自动调用。</p><p>5、 在JAVA + ORACLE 的应用系统开发中，java中内嵌的SQL语句尽量使用大写的形式，以减轻ORACLE解析器的解析负担。</p><p>6、 Java 编程过程中，进行数据库连接、I/O流操作时务必小心，在使用完毕后，及时关闭以释放资源。<br>因为对这些大对象的操作会造成系统大的开销，稍有不慎，会导致严重的后果。</p><p>7、 由于JVM的有其自身的GC机制，不需要程序开发者的过多考虑，从一定程度上减轻了开发者负担，但同时也遗漏了隐患，过分的创建对象会消耗系统的大量内存，严重时会导致内存泄露，因此，保证过期对象的及时回收具有重要意义。</p><p><strong>JVM回收垃圾的条件是：对象不在被引用；</strong>然而，JVM的GC并非十分的机智，即使对象满足了垃圾回收的条件也不一定会被立即回收。<strong>所以，建议我们在对象使用完毕，应手动置成null。</strong></p><p><strong>8、 在使用同步机制时，应尽量使用方法同步代替代码块同步。</strong><br>这里就有问题了，为什么我看有的文章说尽量使用同步代码块？</p><p><strong>9、 尽量减少对变量的重复计算</strong><br>例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; list.size; i ++) &#123;</span><br><span class="line">…</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>应替换为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>,<span class="keyword">int</span> len = list.size();i &lt; len; i ++)</span><br><span class="line">&#123;</span><br><span class="line">…</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>10、尽量采用懒加载的策略，即在需要的时候才开始创建。</strong></p><p>例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String str = “aaa”;</span><br><span class="line"><span class="keyword">if</span>(i == <span class="number">1</span>) &#123;</span><br><span class="line">list.add(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>应替换为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(i == <span class="number">1</span>) </span><br><span class="line">&#123;</span><br><span class="line">    String str = “aaa”;</span><br><span class="line">    list.add(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>11、慎用异常</strong></p><p>异常对性能不利。抛出异常首先要创建一个新的对象。<code>Throwable</code>接口的构造函数调用名为<code>fillInStackTrace()</code>的本地（<code>Native</code>）方法，<code>fillInStackTrace()</code>方法检查堆栈，收集调用跟踪信息。只要有异常被抛出，<code>VM</code>就必须调整调用堆栈，因为在处理过程中创建了一个新的对象。<strong> 异常只能用于错误处理，不应该用来控制程序流程。</strong></p><p><strong>12、不要在循环中使用：Try {} catch() {}应把其放置在最外层。</strong></p><p>13、<code>StringBuffer</code> 的使用：</p><p><code>StringBuffer</code>表示了可变的、可写的字符串。<br>有三个构造方法 :<br><code>StringBuffer();</code> //默认分配16个字符的空间<br><code>StringBuffer (int size);</code> //分配size个字符的空间<br><code>StringBuffer (String str);</code> //分配16个字符+str.length()个字符空间<br>你可以通过<code>StringBuffer</code>的构造函数来设定它的初始化容量，这样可以明显地提升性能。</p><p>这里提到的构造函数是<code>StringBuffer(int length)</code>，<code>length</code>参数表示当前的<code>StringBuffer</code>能保持的字符数量。你也可以使用<code>ensureCapacity(int minimumcapacity)</code>方法在<code>StringBuffer</code>对象创建之后设置它的容量。首先我们看看<code>StringBuffer</code>的缺省行为，然后再找出一条更好的提升性能的途径。</p><p><code>StringBuffer</code>在内部维护一个字符数组，当你使用缺省的构造函数来创建<code>StringBuffer</code>对象的时候，<strong>因为没有设置初始化字符长度，<code>StringBuffer</code>的容量被初始化为16个字符</strong>，也就是说缺省容量就是<code>16</code>个字符。<strong>当<code>StringBuffer</code>达到最大容量的时候，它会将自身容量增加到当前的2倍再加2，也就是（2*旧值+2）</strong>。如果你使用缺省值，初始化之后接着往里面追加字符，在你追加到第16个字符的时候它会将容量增加到34（2<em>16+2），当追加到34个字符的时候就会将容量增加到70（2</em>34+2）。无论何时只要<code>StringBuffer</code>到达它的最大容量它就不得不创建一个新的字符数组然后重新将旧字符和新字符都拷贝一遍――这也太昂贵了点。所以总是给<code>StringBuffer</code>设置一个合理的初始化容量值是错不了的，这样会带来立竿见影的性能增益。<code>StringBuffer</code>初始化过程的调整的作用由此可见一斑。所以，</p><p><strong>使用一个合适的容量值来初始化StringBuffer永远都是一个最佳的建议。</strong></p><p>14、合理的使用Java类 java.util.Vector。</p><p>简单地说，一个Vector就是一个java.lang.Object实例的数组。Vector与数组相似，它的元素可以通过整数形式的索引访问。但是，Vector类型的对象在创建之后，对象的大小能够根据元素的增加或者删除而扩展、缩小。请考虑下面这个向Vector加入元素的例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Object bj = <span class="keyword">new</span> Object();</span><br><span class="line">Vector v = <span class="keyword">new</span> Vector(<span class="number">100000</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> I=<span class="number">0</span>;I&lt;<span class="number">100000</span>; I++)</span><br><span class="line">&#123; </span><br><span class="line">    v.add(<span class="number">0</span>,obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>除非有绝对充足的理由要求每次都把新元素插入到Vector的前面，否则上面的代码对性能不利。在默认构造函数中，Vector的初始存储能力是10个元素，如果新元素加入时存储能力不足，则以后存储能力每次加倍。Vector类就对象StringBuffer类一样，每次扩展存储能力时，所有现有的元素都要复制到新的存储空间之中。下面的代码片段要比前面的例子快几个数量级：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Object bj = <span class="keyword">new</span> Object();</span><br><span class="line">Vector v = <span class="keyword">new</span> Vector(<span class="number">100000</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> I=<span class="number">0</span>; I&lt;<span class="number">100000</span>; I++) </span><br><span class="line">&#123; </span><br><span class="line">    v.add(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同样的规则也适用于Vector类的remove()方法。<strong>由于Vector中各个元素之间不能含有“空隙”，删除除最后一个元素之外的任意其他元素都导致被删除元素之后的元素向前移动，也就是说，从Vector删除最后一个元素要比删除第一个元素“开销”低好几倍。</strong></p><p>假设要从前面的Vector删除所有元素，我们可以使用这种代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> I=<span class="number">0</span>; I&lt;<span class="number">100000</span>; I++)</span><br><span class="line">&#123;</span><br><span class="line">v.remove(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是，与下面的代码相比，前面的代码要慢几个数量级：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> I=<span class="number">0</span>; I&lt;<span class="number">100000</span>; I++)</span><br><span class="line">&#123;</span><br><span class="line">v.remove(v.size()-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从<code>Vector</code>类型的对象<code>v</code>删除所有元素的最好方法是：<br><code>v.removeAllElements();</code></p><p>假设<code>Vector</code>类型的对象<code>v</code>包含字符串“<code>Hello</code>”。考虑下面的代码，它要从这个<code>Vector</code>中删除“<code>Hello</code>”字符串：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">"Hello"</span>;</span><br><span class="line"><span class="keyword">int</span> i = v.indexOf(s);</span><br><span class="line"><span class="keyword">if</span>(I != -<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    v.remove(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这些代码看起来没什么错误，但它同样对性能不利。在这段代码中，<code>indexOf()</code>方法对<code>v</code>进行顺序搜索寻找字符串“<code>Hello</code>”，<code>remove(s)</code>方法也要进行同样的顺序搜索。改进之后的版本是：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">"Hello"</span>;</span><br><span class="line"><span class="keyword">int</span> index = v.indexOf(s);</span><br><span class="line"><span class="keyword">if</span>(index != -<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    v.remove(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个版本中我们直接在<code>remove()</code>方法中给出待删除元素的精确索引位置，从而避免了第二次搜索。一个更好的版本是：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">"Hello"</span>; v.remove(s);</span><br></pre></td></tr></table></figure><p>最后，我们再来看一个有关<code>Vector</code>类的代码片段：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> I=<span class="number">0</span>; I++;I &lt; v.length)</span><br></pre></td></tr></table></figure><p>如果<code>v</code>包含100,000个元素，这个代码片段将调用<code>v.size()</code>方法100,000次。虽然<code>size</code>方法是一个简单的方法，但它仍旧需要一次方法调用的开销，至少<code>JVM</code>需要为它配置以及清除堆栈环境。在这里，<code>for</code>循环内部的代码不会以任何方式修改<code>Vector</code>类型对象<code>v</code>的大小，因此上面的代码最好改写成下面这种形式：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> size = v.size(),<span class="keyword">int</span> I=<span class="number">0</span>; I++;I&lt;size)</span><br></pre></td></tr></table></figure><p></p><p>虽然这是一个简单的改动，但它仍旧赢得了性能。毕竟，每一个<code>CPU</code>周期都是宝贵的。</p><p><strong>15、当复制大量数据时，使用<code>System.arraycopy()</code>命令。</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] src=&#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="keyword">int</span>[] dest = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">6</span>];</span><br><span class="line">System.arraycopy(src, <span class="number">0</span>, dest, <span class="number">0</span>, <span class="number">6</span>);</span><br></pre></td></tr></table></figure><p>src:源数组; srcPos:源数组要复制的起始位置;<br>dest:目的数组; destPos:目的数组放置的起始位置;<br>length:复制的长度.</p><p>注意：src and dest都必须是同类型或者可以进行转换类型的数组．</p><p><strong>16、代码重构：增强代码的可读性。</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopCart</span> </span></span><br><span class="line"><span class="class">   </span>&#123;</span><br><span class="line">       <span class="keyword">private</span> List carts ;</span><br><span class="line">        …</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span> <span class="params">(Object item)</span> </span></span><br><span class="line"><span class="function">       </span>&#123;</span><br><span class="line">           <span class="keyword">if</span>(carts == <span class="keyword">null</span>) </span><br><span class="line">           &#123;</span><br><span class="line">               carts = <span class="keyword">new</span> ArrayList();</span><br><span class="line">           &#125;</span><br><span class="line">           crts.add(item);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Object item)</span> </span></span><br><span class="line"><span class="function">       </span>&#123;</span><br><span class="line">           <span class="keyword">if</span>(carts. contains(item)) </span><br><span class="line">           &#123;</span><br><span class="line">               carts.remove(item);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> List <span class="title">getCarts</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">       </span>&#123;</span><br><span class="line">           <span class="comment">//返回只读列表</span></span><br><span class="line">           <span class="keyword">return</span> Collections.unmodifiableList(carts);</span><br><span class="line">       &#125;</span><br><span class="line">   </span><br><span class="line">       <span class="comment">//不推荐这种方式</span></span><br><span class="line">       <span class="comment">//this.getCarts().add(item);</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><strong>17、不用new关键词创建类的实例</strong></p><p>用<code>new</code>关键词创建类的实例时，构造函数链中的所有构造函数都会被自动调用。但如果一个对象实现了<code>Cloneable</code>接口，我们可以调用它的<code>clone()</code>方法。<code>clone()</code>方法不会调用任何类构造函数。</p><p>在使用设计模式（<code>Design Pattern</code>）的场合，如果用<code>Factory</code>模式创建对象，则改用<code>clone()</code>方法创建新的对象实例非常简单。例如，下面是<code>Factory</code>模式的一个典型实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Credit <span class="title">getNewCredit</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Credit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>改进后的代码使用<code>clone()</code>方法，如下所示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Credit BaseCredit = <span class="keyword">new</span> Credit();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Credit <span class="title">getNewCredit</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (Credit) BaseCredit.clone();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的思路对于数组处理同样很有用。</p><p><strong>18、对于2的整数倍的乘法和除法用移位操作替代</strong></p><p>考虑下面的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (val = <span class="number">0</span>; val &lt; <span class="number">100000</span>; val +=<span class="number">5</span>) </span><br><span class="line">&#123;</span><br><span class="line">    alterX = val * <span class="number">8</span>; myResult = val * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用移位操作替代乘法操作可以极大地提高性能。下面是修改后的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (val = <span class="number">0</span>; val &lt; <span class="number">100000</span>; val += <span class="number">5</span>) </span><br><span class="line">&#123;</span><br><span class="line">    alterX = val &lt;&lt; <span class="number">3</span>; myResult = val &lt;&lt; <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改后的代码不再做乘以8的操作，而是改用等价的左移3位操作<strong>，每左移1位相当于乘以2。相应地，右移1位操作相当于除以2。</strong>值得一提的是，虽然移位操作速度快，但可能使代码比较难于理解，所以最好加上一些注释。</p><p><strong>19、在JSP页面中关闭无用的会话。</strong></p><p><strong>一个常见的误解是以为session在有客户端访问时就被创建，然而事实是直到某server端程序调用HttpServletRequest.getSession(true)这样的语句时才被创建</strong>，注意如果JSP没有显示的使用 &lt;&gt; 关闭session，则JSP文件在编译成Servlet时将会自动加上这样一条语句<code>HttpSession session = HttpServletRequest.getSession(true);</code>这也是JSP中隐含的session对象的来历。<strong>由于session会消耗内存资源，因此，如果不打算使用session，应该在所有的JSP中关闭它。</strong><br>对于那些无需跟踪会话状态的页面，关闭自动创建的会话可以节省一些资源。使用如下page指令：<code>&lt;%@ page session=&quot;false&quot;%&gt;</code></p><p><strong>20、JDBC与I/O</strong></p><p>如果应用程序需要访问一个规模很大的数据集，则应当考虑使用块提取方式。<strong>默认情况下，JDBC每次提取32行数据</strong>。举例来说，假设我们要遍历一个5000行的记录集，JDBC必须调用数据库157次才能提取到全部数据。如果把块大小改成512，则调用数据库的次数将减少到10次。</p><p><strong>21、Servlet与内存使用</strong><br>许多开发者随意地把大量信息保存到用户会话之中。<strong>一些时候，保存在会话中的对象没有及时地被垃圾回收机制回收</strong>。从性能上看，典型的症状是用户感到系统周期性地变慢，却又不能把原因归于任何一个具体的组件。如果监视JVM的堆空间，它的表现是内存占用不正常地大起大落。<br>解决这类内存问题主要有二种办法。<strong>第一种办法是，在所有作用范围为会话的Bean中实现<code>HttpSessionBindingListener</code>接口。这样，只要实现valueUnbound()方法，就可以显式地释放Bean使用的资源</strong>。</p><p><strong>另外一种办法就是尽快地把会话作废</strong>。大多数应用服务器都有设置会话作废间隔时间的选项。另外，也可以用编程的方式调用会话的setMaxInactiveInterval()方法，该方法用来设定在作废会话之前，Servlet容器允许的客户请求的最大间隔时间，以秒计。</p><p><strong>22、使用缓冲标记</strong></p><p>一些应用服务器加入了面向JSP的缓冲标记功能。例如，BEA的WebLogic Server从6.0版本开始支持这个功能，Open Symphony工程也同样支持这个功能。JSP缓冲标记既能够缓冲页面片断，也能够缓冲整个页面。当JSP页面执行时，如果目标片断已经在缓冲之中，则生成该片断的代码就不用再执行。页面级缓冲捕获对指定URL的请求，并缓冲整个结果页面。对于购物篮、目录以及门户网站的主页来说，这个功能极其有用。对于这类应用，页面级缓冲能够保存页面执行的结果，供后继请求使用。</p><p>23、选择合适的引用机制</p><p>在典型的JSP应用系统中，页头、页脚部分往往被抽取出来，然后根据需要引入页头、页脚。当前，在JSP页面中引入外部资源的方法主要有两种：include指令，以及include动作。<br>include指令：例如&lt;%@ include file=”copyright.html” %&gt;。该指令在编译时引入指定的资源。在编译之前，带有include指令的页面和指定的资源被合并成一个文件。被引用的外部资源在编译时就确定，比运行时才确定资源更高效。<br>include动作：例如&lt;jsp:include page=”copyright.jsp” /&gt;。该动作引入指定页面执行后生成的结果。由于它在运行时完成，因此对输出结果的控制更加灵活。但时，只有当被引用的内容频繁地改变时，或者在对主页面的请求没有出现之前，被引用的页面无法确定时，使用include动作才合算。</p><p>24、及时清除不再需要的会话</p><p>为了清除不再活动的会话，许多应用服务器都有默认的会话超时时间，一般为30分钟。当应用服务器需要保存更多会话时，如果内存容量不足，操作系统会把部分内存数据转移到磁盘，应用服务器也可能根据“最近最频繁使用”（Most Recently Used）算法把部分不活跃的会话转储到磁盘，甚至可能抛出“内存不足”异常。在大规模系统中，串行化会话的代价是很昂贵的。当会话不再需要时，应当及时调用HttpSession.invalidate()方法清除会话。HttpSession.invalidate()方法通常可以在应用的退出页面调用。</p><p>25、不要将数组声明为：public static final 。</p><p>26、HashMap的遍历效率讨论</p><p>经常遇到对HashMap中的key和value值对的遍历操作，有如下两种方法：<br>Map&lt;String, String[]&gt; paraMap = new HashMap&lt;String, String[]&gt;();<br>//第一个循环<br>Set<string>appFieldDefIds = paraMap.keySet();<br>for (String appFieldDefId : appFieldDefIds) {<br>String[] values = paraMap.get(appFieldDefId);<br>……<br>}</string></p><p>//第二个循环<br>for(Entry&lt;String, String[]&gt; entry : paraMap.entrySet()){<br>String appFieldDefId = entry.getKey();<br>String[] values = entry.getValue();<br>…….<br>}<br>第一种实现明显的效率不如第二种实现。<br>分析如下 Set<string>appFieldDefIds = paraMap.keySet(); 是先从HashMap中取得keySet<br>代码如下：<br>public Set<k>keySet() {<br>Set<k>ks = keySet;<br>return (ks != null ? ks : (keySet = new KeySet()));<br>}</k></k></string></p><p>private class KeySet extends AbstractSet<k>{<br>public Iterator<k>iterator() {<br>return newKeyIterator();<br>}<br>public int size() {<br>return size;<br>}<br>public boolean contains(Object o) {<br>return containsKey(o);<br>}<br>public boolean remove(Object o) {<br>return HashMap.this.removeEntryForKey(o) != null;<br>}<br>public void clear() {<br>HashMap.this.clear();<br>}<br>}</k></k></p><p>其实就是返回一个私有类KeySet, 它是从AbstractSet继承而来，实现了Set接口。</p><p>再来看看for/in循环的语法<br>for(declaration : expression)<br>statement</p><p>在执行阶段被翻译成如下各式<br>for(Iterator<e>#i = (expression).iterator(); #i.hashNext();){<br>declaration = #i.next();<br>statement<br>}</e></p><p>因此在第一个for语句for (String appFieldDefId : appFieldDefIds) 中调用了HashMap.keySet().iterator()</p><p>而这个方法调用了newKeyIterator()</p><p>Iterator<k>newKeyIterator() {<br>return new KeyIterator();<br>}<br>private class KeyIterator extends HashIterator<k>{<br>public K next() {<br>return nextEntry().getKey();<br>}<br>}</k></k></p><p>所以在for中还是调用了<br>在第二个循环for(Entry&lt;String, String[]&gt; entry : paraMap.entrySet())中使用的Iterator是如下的一个内部</p><p>类</p><p>private class EntryIterator extends HashIterator&lt;Map.Entry&lt;K,V&gt;&gt; {<br>public Map.Entry&lt;K,V&gt; next() {<br>return nextEntry();<br>}<br>}</p><p>此时第一个循环得到key，第二个循环得到HashMap的Entry效率就是从循环里面体现出来的第二个循环此致可以直接取key和value值而第一个循环还是得再利用HashMap的get(Object key)来取value值现在看看HashMap的get(Object key)方法<br>public V get(Object key) {<br>Object k = maskNull(key);<br>int hash = hash(k);<br>int i = indexFor(hash, table.length); //Entry[] table<br>Entry&lt;K,V&gt; e = table;<br>while (true) {<br>if (e == null)<br>return null;<br>if (e.hash == hash &amp;&amp; eq(k, e.key))<br>return e.value;<br>e = e.next;<br>}<br>}<br>其实就是再次利用Hash值取出相应的Entry做比较得到结果，所以使用第一中循环相当于两次进入HashMap的Entry</p><p>中而第二个循环取得Entry的值之后直接取key和value，效率比第一个循环高。其实按照Map的概念来看也应该是用第二个循环好一点，它本来就是key和value的值对，将key和value分开操作在这里不是个好选择。</p><p>27、array(数组) 和 ArryList的使用</p><p>array（[]）：最高效；但是其容量固定且无法动态改变；<br>ArrayList：容量可动态增长；但牺牲效率；<br>基于效率和类型检验，应尽可能使用array，无法确定数组大小时才使用ArrayList！<br>ArrayList是Array的复杂版本<br>ArrayList内部封装了一个Object类型的数组，从一般的意义来说，它和数组没有本质的差别，甚至于ArrayList的许多方法，如Index、IndexOf、Contains、Sort等都是在内部数组的基础上直接调用Array的对应方法。<br>ArrayList存入对象时，抛弃类型信息，所有对象屏蔽为Object，编译时不检查类型，但是运行时会报错。<br>注：jdk5中加入了对泛型的支持，已经可以在使用ArrayList时进行类型检查。<br>从这一点上看来，ArrayList与数组的区别主要就是由于动态增容的效率问题了</p><p>28、尽量使用HashMap 和ArrayList ,除非必要，否则不推荐使用HashTable和Vector ，后者由于使用同步机制，而导致了性能的开销。</p><p>29、StringBuffer 和StringBuilder的区别：</p><p>java.lang.StringBuffer线程安全的可变字符序列。一个类似于 String 的字符串缓冲区，但不能修改。</p><p>StringBuilder。与该类相比，通常应该优先使用 java.lang.StringBuilder类，因为它支持所有相同的操作，但由于它不执行同步，所以速度更快。为了获得更好的性能，在构造 StirngBuffer 或 StirngBuilder 时应尽可能指定它的容量。当然，如果你操作的字符串长度不超过 16 个字符就不用了。 相同情况下使用 StirngBuilder 相比使用 StringBuffer 仅能获得 10%-15% 左右的性能提升，但却要冒多线程不安全的风险。而在现实的模块化编程中，负责某一模块的程序员不一定能清晰地判断该模块是否会放入多线程的环境中运行，因此：除非你能确定你的系统的瓶颈是在 StringBuffer 上，并且确定你的模块不会运行在多线程模式下，否则还是用 StringBuffer 吧。</p><p>30、尽量避免使用split</p><p>除非是必须的，否则应该避免使用split，split由于支持正则表达式，所以效率比较低，如果是频繁的几十，几百万的调用将会耗费大量资源，如果确实需要频繁的调用split，可以考虑使用apache的 StringUtils.split(string,char)，频繁split的可以缓存结果。</p><p>其他补充:</p><p>1、及时清除不再使用的对象，设为null<br>2、尽可能使用final,static等关键字<br>3、尽可能使用buffered对象</p><p>如何优化代码使JAVA源文件及编译后CLASS文件更小<br>1 尽量使用继承，继承的方法越多，你要写的代码量也就越少<br>2 打开JAVA编译器的优化选项： javac -O 这个选项将删除掉CLASS文件中的行号，并能把<br>一些private, static,final的小段方法申明为inline方法调用<br>3 把公用的代码提取出来<br>4 不要初始化很大的数组，尽管初始化一个数组在JAVA代码中只是一行的代码量，但<br>编译后的代码是一行代码插入一个数组的元素，所以如果你有大量的数据需要存在数组<br>中的话，可以先把这些数据放在String中，然后在运行期把字符串解析到数组中<br>5 日期类型的对象会占用很大的空间，如果你要存储大量的日期对象，可以考虑把它存储为<br>long型，然后在使用的时候转换为Date类型<br>6 类名，方法名和变量名尽量使用简短的名字，可以考虑使用Hashjava, Jobe, Obfuscate and Jshrink等工具自动完成这个工作<br>7 将static final类型的变量定义到Interface中去<br>8 算术运算 能用左移/右移的运算就不要用*和/运算，相同的运算不要运算多次</p><ol start="2"><li>不要两次初始化变量<br>Java通过调用独特的类构造器默认地初始化变量为一个已知的值。所有的对象被设置成null，integers (byte, short, int, long)被设置成0，float和double设置成0.0，Boolean变量设置成false。这对那些扩展自其它类的类尤其重要，这跟使用一个新的关键词创建一个对象时所有一连串的构造器被自动调用一样。</li><li><p>在任何可能的地方让类为Final<br>标记为final的类不能被扩展。在《核心Java API》中有大量这个技术的例子，诸如java.lang.String。将String类标记为final阻止了开发者创建他们自己实现的长度方法。<br>更深入点说，如果类是final的，所有类的方法也是final的。Java编译器可能会内联所有的方法（这依赖于编译器的实现）。在我的测试里，我已经看到性能平均增加了50%。</p></li><li><p>异常在需要抛出的地方抛出，try catch能整合就整合<br>try {<br>some.method1(); // Difficult for javac<br>} catch( method1Exception e ) { // and the JVM runtime<br>// Handle exception 1 // to optimize this<br>} // code<br>try {<br>some.method2();<br>} catch( method2Exception e ) {<br>// Handle exception 2<br>}</p></li></ol><p>try {<br>some.method3();<br>} catch( method3Exception e ) {<br>// Handle exception 3<br>}<br>已下代码 更容易被编译器优化<br>try {<br>some.method1(); // Easier to optimize<br>some.method2();<br>some.method3();<br>} catch( method1Exception e ) {<br>// Handle exception 1<br>} catch( method2Exception e ) {<br>// Handle exception 2<br>} catch( method3Exception e ) {<br>// Handle exception 3<br>}</p><ol start="10"><li>For循环的优化<br>Replace…<br>for( int i = 0; i &lt; collection.size(); i++ ) {<br>…<br>}</li></ol><p>with…<br>for( int i = 0, n = collection.size(); i &lt; n; i++ ) {<br>…<br>}</p><p><strong>5、 在JAVA + ORACLE 的应用系统开发中，java中内嵌的SQL语句尽量使用大写的形式，以减轻ORACLE解析器的解析负担。</strong></p><p>10、尽量采用lazy loading 的策略，即在需要的时候才开始创建。<br>例如： String str = “aaa”;<br>if(i == 1) {<br>list.add(str);<br>}<br>应替换为：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span>(i == <span class="number">1</span>) &#123;</span><br><span class="line">String str = “aaa”;</span><br><span class="line">list.add(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>12、不要在循环中使用：<br>Try {<br>} catch() {<br>}<br>应把其放置在最外层</p><p>以上所述就是本文的全部内容了，希望能够对大家的java优化有所帮助。</p><p>本文链接: <a href="https://www.lansheng.net.cn/blog/5ab73df2/">30个要点帮你完成java代码优化</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article></section><nav class="pagination"><a class="extend prev" rel="prev" href="/page/24/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><span class="page-number current">25</span></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="蓝生"><p class="site-author-name" itemprop="name">蓝生</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">243</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">81</span> <span class="site-state-item-name">分类</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://blog.csdn.net/qq_21808961" target="_blank" title="CSDN"><i class="fa fa-fw fa-arrow-right"></i>CSDN</a> </span><span class="links-of-author-item"><a href="https://www.shixiseng.com/" target="_blank" title="实习僧"><i class="fa fa-fw fa-arrow-right"></i>实习僧</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://ziyuan.baidu.com/xzh/home/index" title="百度熊掌号" target="_blank">百度熊掌号</a></li><li class="links-of-blogroll-item"><a href="https://ziyuan.baidu.com/linksubmit/index" title="百度链接提交" target="_blank">百度链接提交</a></li><li class="links-of-blogroll-item"><a href="https://reuixiy.github.io/" title="超好看的Hexo+NexT博客" target="_blank">超好看的Hexo+NexT博客</a></li><li class="links-of-blogroll-item"><a href="https://www.face2ai.com/" title="谭升" target="_blank">谭升</a></li></ul></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span> <span class="with-love" id="animate"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">蓝生</span></div><div class="theme-info"><div class="powered-by"></div><span class="post-count">博客全站共343.2k字</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv" title="总访客量"><i class="fa fa-user"></i> 总访客量:<span class="busuanzi-value" id="busuanzi_value_site_uv"></span> </span><span class="site-pv" title="总访问量"><i class="fa fa-eye"></i> 总访问量:<span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script><script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script><script type="text/javascript" src="/js/src/affix.js?v=6.4.0"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">var GUEST=["nick","mail","link"],guest="nick,mail,link";guest=guest.split(",").filter(function(e){return GUEST.indexOf(e)>-1}),new Valine({el:"#comments",verify:!0,notify:!1,appId:"8uEACQMqUrxjo1Hqof21pkCV-gzGzoHsz",appKey:"DgRm99ypfVS7Mm9YLchO1RGG",placeholder:"填写昵称,邮箱,网址即可评论.昵称可随意写,邮箱用于接收回复提醒,网址也设置为你个人网站或者博客的地址.",avatar:"mm",meta:guest,pageSize:"10",visitor:!1})</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script></body></html><script type="text/javascript" src="/js/src/love.js"></script><!-- rebuild by neat -->